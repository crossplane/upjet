spec:
  steps:
  - exec:
      command: sh
      args:
        - "-c"
        - "kubectl get managed -o yaml > backup/managed-resources.yaml"
    name: backup-managed-resources
    manualExecution:
      - sh -c "kubectl get managed -o yaml > backup/managed-resources.yaml"
    type: Exec
    description: "Backing up Managed Resources"

  - exec:
      command: sh
      args:
        - "-c"
        - "kubectl get composite -o yaml > backup/composite-resources.yaml"
    name: backup-composite-resources
    manualExecution:
      - sh -c "kubectl get composite -o yaml > backup/composite-resources.yaml"
    type: Exec
    description: "Backing up Composite Resources"

  - exec:
      command: sh
      args:
        - "-c"
        - "kubectl get claim --all-namespaces -o yaml > backup/claim-resources.yaml"
    name: backup-claim-resources
    manualExecution:
      - sh -c "kubectl get claim --all-namespaces -o yaml > backup/claim-resources.yaml"
    type: Exec
    description: "Backing up Claims from all namespaces"

  - exec:
      command: sh
      args:
        - "-c"
        - "cp edit-configuration-metadata/platform-ref-aws.configurations.meta.pkg.crossplane.io_v1.yaml testdata/plan/configurationv1.yaml"
    name: edit-configuration-metadata
    manualExecution:
      - sh -c "cp edit-configuration-metadata/platform-ref-aws.configurations.meta.pkg.crossplane.io_v1.yaml testdata/plan/configurationv1.yaml"
    type: Exec
    description: "Replacing the monolithic provider dependencies in the Configuration metadata with references to the new family providers"

  - exec:
      command: sh
      args:
        - "-c"
        - "up xpkg build --package-root={{PKG_ROOT}} --examples-root={{EXAMPLES_ROOT}} -o {{PKG_PATH}}"
    name: build-configuration
    manualExecution:
      - sh -c "up xpkg build --package-root={{PKG_ROOT}} --examples-root={{EXAMPLES_ROOT}} -o {{PKG_PATH}}"
    type: Exec
    description: "Building the new Configuration package using up"

  - exec:
      command: sh
      args:
        - "-c"
        - "up xpkg push {{TARGET_CONFIGURATION_PACKAGE}} -f {{PKG_PATH}}"
    name: push-configuration
    manualExecution:
      - sh -c "up xpkg push {{TARGET_CONFIGURATION_PACKAGE}} -f {{PKG_PATH}}"
    type: Exec
    description: "Pushing the new Configuration package"

version: 0.1.0
